<app-navbar [page]='"home"'></app-navbar>
<div [ngClass]="{'mobile-browser': !is_full}">
    <div class='header-container'>
        <div class="header-inner-container">
            <img *ngIf="!is_full" class='logo-mobile-home' routerLink='/home' src='assets/img/logo.svg'>
            <div id='title-div'>
                <div>
                    <p *ngIf="is_full" class='mat-display-1' id='title-text'>#HowsMyFlattening</p>
                    <p class='mat-headline home-header-sub' id='subtitle-text'>A centralized data
                        analytics and
                        visualization
                        hub monitoring Ontario's response to COVID-19</p>
                </div>
            </div>
        </div>
    </div>
    <div class='content' style='background-color: white;'>
        <div id='container' style="margin:0">
            <div class='home-page-card which-curve'>
                <div id='which-curve-text'>
                    <div>
                        <h1 class="main-header-styling">
                            Controlling COVID-19 in Institutions
                        </h1>
                        <p class="sub-header-styling">
                            <strong>Over the past few weeks, the tide of the pandemic has shifted into two distinct
                                streams: the community at-large and institutional settings such as long-term care homes
                                (LTCs), retirement homes, hospitals, homeless shelters, and prisons. People in these
                                institutional settings are more vulnerable to COVID-19.</strong>
                        </p>
                        <br>

                        <p class="sub-header-paragraph">
                            The Ontario government is tracking if a confirmed positive case is linked to an outbreak of
                            COVID-19 in these various institutions. This graph displays if daily new cases are
                            originating from the community at-large or are linked to outbreaks.
                        </p>
                        <br>
                        <p class="sub-header-paragraph">
                            This visualization shows us that we have <a class="home-page-link">#FlattenedTheCurve in
                                institutions</a> through comprehensive testing, intensive infection control, and other
                            policies to minimize risk of transmission, such as restricting staff to one LTC home and
                            providing safe isolation settings for people experiencing homelessness. However, as of early
                            May, the number of new cases in the community at-large is greater than the case of outbreaks
                            indicating mitigation - but not elimination.
                        </p>

                        <p class="sub-header-paragraph">
                            <a class="home-page-link">Controlling community transmission must mirror our successes in
                                controlling outbreaks.</a>
                        </p>

                    </div>
                </div>
                <div id="vizContainer"></div>
            </div>
            <div *ngIf="is_full" class="table-container">
                <div class="scorecard-header">Ontario's Reopening Metrics</div>
                <div>
                    <mat-progress-spinner mode="indeterminate" diameter="50" style="margin: 0 auto;"
                        *ngIf="ontarioObj.rt === null">
                    </mat-progress-spinner>
                </div>
                <table *ngIf="ontarioObj.rt !== null" class="table-styling">
                    <tr>
                        <th class="ontario-header-styling" colspan="2">
                            <div class="ontario-header-container">
                                <img class="ontario-header-img" src='assets/img/pandemic_monitoring.svg'>
                                <div class="ontario-header-text">
                                    Pandemic Monitoring
                                </div>
                            </div>
                        </th>
                        <th class="ontario-header-styling" colspan="2">
                            <div class="ontario-header-container">
                                <img class="ontario-header-img" src='assets/img/response_monitoring.svg'>
                                <div class="ontario-header-text">
                                    Response Monitoring
                                </div>
                            </div>
                        </th>
                        <th class="ontario-header-styling" colspan="2">
                            <div class="ontario-header-container">
                                <img class="ontario-header-img" src='assets/img/response_capacity.svg'>
                                <div class="ontario-header-text">
                                    Response Capacity
                                </div>
                            </div>
                        </th>
                    </tr>
                    <tr class="ontario-row-styling">
                        <td class="center-cell" style="width: 10%; background-color: #b2eda4">{{ontarioObj.rt}}</td>
                        <td class="center-cell border-right-white" style="background-color: #b2eda4">RT Value</td>
                        <td class="center-cell border-left-white"
                            [ngClass]="{'black-cell': ontarioObj.testing === 'nan'}" style="width: 10%;">
                            {{ontarioObj.testing === 'nan' ? 'N/A' : ontarioObj.testing}}
                        </td>
                        <td class="center-cell border-right-white" style="background-color: #b2eda4">Testing Percentage
                            &lt; 24h</td>
                        <td class="center-cell border-left-white" style="width: 10%; background-color: #b2eda4"
                            rowspan="2">
                            {{ontarioObj.icu}}</td>
                        <td class="center-cell" style="background-color: #b2eda4" rowspan="2">Total ICU Bed Occupied
                            Percentage</td>
                    </tr>
                    <tr class="ontario-row-styling">
                        <td class="center-cell" style="width: 10%; background-color: #b2eda4">{{ontarioObj.weekly}}</td>
                        <td class="center-cell border-right-white" style="background-color: #b2eda4">Weekly New Cases
                        </td>
                        <td class="center-cell border-left-white"
                            [ngClass]="{'black-cell': ontarioObj.tracing === 'nan'}" style="width: 10%;">
                            {{ontarioObj.tracing === 'nan' ? 'N/A' : ontarioObj.tracing}}
                        </td>
                        <td class="center-cell border-right-white" style="background-color: #b2eda4">Tracing Percentage
                            &lt; 24h</td>
                    </tr>
                </table>
                <div class="scorecard-header">PHU Performance Overview by Metrics</div>
                <div>
                    <mat-progress-spinner mode="indeterminate" diameter="50" style="margin: 0 auto;"
                        *ngIf="!sortedMetrics">
                    </mat-progress-spinner>
                </div>
                <div *ngIf="sortedMetrics">
                    <img class="trend-img" src='assets/img/trend.png'>
                </div>
                <table matSort (matSortChange)="sortMetrics($event)" *ngIf="sortedMetrics" class="table-styling">
                    <tr>
                        <th></th>
                        <th colspan="2" class="top-category">Pandemic Monitoring</th>
                        <th colspan="2" class="top-category">Response Monitoring</th>
                        <th class="top-category">Response Capacity</th>
                        <th class="top-category">Stages</th>
                    </tr>
                    <tr>
                        <th mat-sort-header="phu" class="first-col-styling header-styling black-cell">PHU</th>
                        <th mat-sort-header="rt" class="header-styling black-cell">RT</th>
                        <th mat-sort-header="new" class="header-styling black-cell">Weekly New Cases</th>
                        <th mat-sort-header="testing" class="header-styling black-cell">Testing % &lt; 24h</th>
                        <th mat-sort-header="tracing" class="header-styling black-cell">Tracing % &lt; 24h</th>
                        <th mat-sort-header="icu" class="header-styling black-cell">Total ICU Bed Occupied %</th>
                        <th mat-sort-header="stage" class="header-styling black-cell">Stage</th>
                    </tr>
                    <tr *ngFor="let row of sortedMetrics; index as index" class="row-styling"
                        [style.background-color]="index % 2 === 0 ? '#ffffff' : '#F2F2F2'">
                        <td class="first-col-cell" [title]="row.phu">{{row.phu}}</td>
                        <td [ngClass]="{'black-cell': row.rt === 'nan'}" class="center-cell">
                            {{row.rt === 'nan' ? 'N/A' : row.rt}}</td>
                        <td [ngClass]="{'black-cell': row.weekly === 'nan'}" class="center-cell">
                            {{row.weekly === 'nan' ? 'N/A' : row.weekly}}</td>
                        <td [ngClass]="{'black-cell': row.testing === 'nan'}" class="center-cell">
                            {{row.testing === 'nan' ? 'N/A' : (row.testing+"%")}}</td>
                        <td [ngClass]="{'black-cell': row.tracing === 'nan'}" class="center-cell">
                            <div *ngIf="row.tracing !== 'nan'">{{row.tracing}}</div>
                            <img *ngIf="row.tracing === 'nan'" class="missing-data-icon ontario-header-img" src='assets/img/missing_data.svg'>
                        <td [ngClass]="{'black-cell': row.icu === 'nan'}" class="center-cell">
                            {{row.icu === 'nan' ? 'N/A' : row.icu}}</td>
                        <td [ngClass]="{'black-cell': row.staging === 'nan'}" class="center-cell">
                            {{row.stage === 'nan' ? 'N/A' : row.stage}}</td>
                    </tr>
                </table>
            </div>
            <div *ngIf="!is_full">
                <div class="scorecard-header">Ontario's Reopening Metrics</div>
                <div>
                    <mat-progress-spinner mode="indeterminate" diameter="50" style="margin: 0 auto;"
                        *ngIf="ontarioObj.rt === null">
                    </mat-progress-spinner>
                </div>
                <table *ngIf="ontarioObj.rt !== null" class="mobile-ontario-table">
                    <tr>
                        <th colspan="2" class="ontario-header-styling top-category" colspan="2">
                            <div class="ontario-header-container">
                                <img class="ontario-header-img" src='assets/img/pandemic_monitoring.svg'>
                                <div class="ontario-header-text">
                                    Pandemic Monitoring
                                </div>
                            </div>
                        </th>
                    </tr>
                    <tr class="ontario-row-styling">
                        <td class="center-cell" style="width: 10%; background-color: #b2eda4">{{ontarioObj.rt}}</td>
                        <td class="center-cell" style="background-color: #b2eda4">RT Value</td>
                    </tr>
                    <tr class="ontario-row-styling">
                        <td class="center-cell" style="width: 10%; background-color: #b2eda4">{{ontarioObj.weekly}}</td>
                        <td class="center-cell" style="background-color: #b2eda4">Weekly New Cases</td>
                    </tr>
                </table>
                <table *ngIf="ontarioObj.rt !== null" class="mobile-ontario-table">
                    <tr>
                        <th colspan="2" class="ontario-header-styling top-category" colspan="2">
                            <div class="ontario-header-container">
                                <img class="ontario-header-img" src='assets/img/response_monitoring.svg'>
                                <div class="ontario-header-text">
                                    Response Monitoring
                                </div>
                            </div>
                        </th>
                    </tr>
                    <tr class="ontario-row-styling">
                        <td class="center-cell" [ngClass]="{'black-cell': ontarioObj.testing === 'nan'}"
                            style="width: 10%;">{{ontarioObj.testing === 'nan' ? 'N/A' : ontarioObj.testing}}
                        </td>
                        <td class="center-cell">Testing Percentage &lt; 24h</td>
                    </tr>
                    <tr class="ontario-row-styling">
                        <td class="center-cell" [ngClass]="{'black-cell': ontarioObj.tracing === 'nan'}"
                            style="width: 10%;">{{ontarioObj.tracing === 'nan' ? 'N/A' : ontarioObj.tracing}}
                        </td>
                        <td class="center-cell">Tracing Percentage &lt; 24h</td>
                    </tr>
                </table>
                <table *ngIf="ontarioObj.rt !== null" class="mobile-ontario-table">
                    <tr>
                        <th colspan="2" class="ontario-header-styling top-category" colspan="2">
                            <div class="ontario-header-container">
                                <img class="ontario-header-img" src='assets/img/response_capacity.svg'>
                                <div class="ontario-header-text">
                                    Response Capacity
                                </div>
                            </div>
                        </th>
                    </tr>
                    <tr class="ontario-row-styling">
                        <td class="center-cell" style="width: 10%; background-color: #b2eda4" rowspan="2">
                            {{ontarioObj.icu}}</td>
                        <td class="center-cell" style="background-color: #b2eda4" rowspan="2">Total ICU Bed Occupied
                            Percentage</td>
                    </tr>
                    <tr></tr>
                </table>
                <div class="scorecard-header">PHU Performance Overview by Metrics</div>
                <div>
                    <mat-progress-spinner mode="indeterminate" diameter="50" style="margin: 0 auto;"
                        *ngIf="!sortedMetrics">
                    </mat-progress-spinner>
                </div>
                <div *ngIf="dropdownSelection && sortedMetrics" style="padding-top: 10px; width: 90%; margin: auto;">
                    <div>
                        <img class="trend-img" src='assets/img/trend.png'>
                    </div>
                    <form [formGroup]="dropdownSelection">
                        <mat-form-field style="width: 100%;">
                            <mat-label>Jump to a Specific Public Health Unit</mat-label>
                            <mat-select formControlName="phu" disableOptionCentering
                                (selectionChange)="scrollTo(dropdownSelection.controls.phu.value)">
                                <ngx-mat-select-search formControlName="searchCtrl" [placeholderLabel]="'Search...'"
                                    [noEntriesFoundLabel]="'Not found'" name="search"></ngx-mat-select-search>
                                <mat-option
                                    *ngFor="let phu of phuArray |stringFilterBy:dropdownSelection.controls.searchCtrl.value:'phu'; index as index"
                                    [value]="phu.phu">
                                    {{phu.phu}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </form>

                    <!-- <mat-label><a target="_blank" href="https://www.phdapps.health.gov.on.ca/PHULocator/">Find a Public Health Unit</a> </mat-label> -->
                </div>
                <div #phuArray *ngFor="let table of sortedMetrics" class="mobile-separator">
                    <table [id]="table.phu" class="mobile-scorecard-table-styling">
                        <tr>
                            <th class="mobile-phu-header" colspan="2">{{table.phu}}</th>
                        </tr>
                        <tr>
                            <td class="mobile-header-cell">Stage</td>
                            <td class="mobile-data-cell center-cell">{{table.stage}}</td>
                        </tr>
                        <tr>
                            <th class="mobile-category-header" colspan="2">Pandemic Monitoring</th>
                        </tr>
                        <tr>
                            <td class="mobile-header-cell">RT</td>
                            <td [ngClass]="{'black-cell': table.rt === 'nan'}" class="mobile-data-cell center-cell">
                                {{table.rt === 'nan' ? 'N/A' : table.rt}}</td>
                        </tr>
                        <tr>
                            <td class="mobile-header-cell alternate-row">Weekly New Cases</td>
                            <td [ngClass]="{'black-cell': table.weekly === 'nan'}" class="mobile-data-cell center-cell">
                                {{table.weekly === 'nan' ? 'N/A' : table.weekly}}</td>
                        </tr>
                        <tr>
                            <th class="mobile-category-header" colspan="2">Response Monitoring</th>
                        </tr>
                        <tr>
                            <td class="mobile-header-cell">Testing % &lt; 24h</td>
                            <td [ngClass]="{'black-cell': table.testing === 'nan'}"
                                class="mobile-data-cell center-cell">
                                {{table.testing === 'nan' ? 'N/A' : table.testing}}</td>
                        </tr>
                        <tr>
                            <td class="mobile-header-cell alternate-row">Tracing % &lt; 24h</td>
                            <td [ngClass]="{'black-cell': table.tracing === 'nan'}"
                                class="mobile-data-cell center-cell">
                                {{table.tracing === 'nan' ? 'N/A' : table.tracing}}</td>
                        </tr>
                        <tr>
                            <th class="mobile-category-header" colspan="2">Response Capacity</th>
                        </tr>
                        <tr>
                            <td class="mobile-header-cell">Total ICU Bed Occupied %</td>
                            <td [ngClass]="{'black-cell': table.icu === 'nan'}" class="mobile-data-cell center-cell">
                                {{table.icu === 'nan' ? 'N/A' : table.icu}}</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="card-container scorecard-info-container">
                <div class="mobile-scorecard-container">
                    <div class="scorecard-info-header">Data Sources</div>
                </div>
                <div class="mobile-scorecard-container">
                    <div class="scorecard-info-header">A Note On Missing Data</div>
                    <div style="display: flex" [style.flex-wrap]="!is_full ? 'wrap': 'none'">
                        <div class="missing-data-icon-container">
                            <img class="missing-data-icon ontario-header-img" src='assets/img/missing_data.svg'>
                            <div class="missing-data-header">A data blackout</div>
                        </div>
                        <div [style.width]="!is_full ? '100%' : 'auto'">
                            A number of key data items in the scorecard above, such as contact tracing capacity, are
                            listed as not available. Data for these crucial indicators is currently not available or
                            not reported publicly.
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-container footer-info-container">
                <div class='half-width-left'>
                    <div id='explore-data-cell'>
                        <div class="data-cell-container">
                            <div id='explore-data-cell-text'>Updates on Ontario's Latest Metrics</div>
                            <button class="home-page-button" routerLink='/dashboard'>Explore <span
                                    *ngIf="is_full">Dashboard</span></button>
                        </div>
                    </div>
                </div>
                <div class="container-divider">
                </div>
                <div class='half-width-right'>
                    <div id='explore-data-cell'>
                        <div class="data-cell-container">
                            <div id='explore-data-cell-text'>For further Ontario-specific Insights</div>
                            <button class="home-page-button" routerLink='/analysis'>Explore <span
                                    *ngIf="is_full">Analyses</span></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class='footer'>
        <!-- <div class="footer-text">In partnership with</div>
        <div class="inner-footer">
            <div>
                <a target="_blank" href='https://trilliumhealthpartners.ca'>
                    <img id='resource_thumbnail' src='assets/img/team_supporters/klick_health_logo.png'>
                </a>
            </div>
            <div>
                <a target="_blank" href='https://trilliumhealthpartners.ca'>
                    <img id='resource_thumbnail' src='assets/img/team_supporters/uot_logo.png'>
                </a>
            </div>
            <div>
                <a target="_blank" href='https://trilliumhealthpartners.ca'>
                    <img id='resource_thumbnail' src='assets/img/team_supporters/red_hat.png'>
                </a>
            </div>
        </div> -->
    </div>