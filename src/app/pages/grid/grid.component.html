<app-navbar [shows_title]='true' [page]='"dashboard"'></app-navbar>
<div class='content' style='background-color: white; margin-top: 50px;'>

    <div id='container' [ngClass]="{'mobile-sizing': !is_full}">
        <div [ngClass]="{'analysis-header': !is_full}">
            <!-- <div [ngClass]="{'inner-analysis-header': !is_full}">
                <h1>Ontario-specific COVID-19 Analysis</h1>
                <div>

                    This page highlights analyses that provide further Ontario-specific insights as we monitor
                    performance
                    to
                    flatten the curve. The following dashboard overviews the key insights for Ontario. Select an
                    analysis
                    below
                    the dashboard for an in-depth exploration.<br><br><br>
                </div>
            </div> -->
        </div>
        <!-- <div class="form-container kpi-header" [ngClass]="{'mobile-kpi-styling': !is_full}">
            <div class="kpi-title purple-font" [ngClass]="{'center-text': !is_full}">Ontario at-a-Glance</div>
            <div class="kpi-line" *ngIf='is_full'></div>
        </div> -->
        <!-- <div id="kpiContainer" [ngClass]="{'mobile-sizing': !is_full}"></div> -->
        <div [ngClass]="{'modal-opened': selectedCategory !== ''}">
            <!-- <div class="form-container">
                <form *ngIf="filteringCheckboxes" [formGroup]="filteringCheckboxes" class="form-styling">
                    <div style="display: flex;">
                        <div *ngFor="let category of gridList">
                            <div *ngFor="let item of category | keyvalue"
                                style="margin-right: 25px; border-radius: 6px; background-color: #245D70; color: #ffffff; padding: 6px 12px">
                                <mat-checkbox formControlName="{{item.key}}">{{item.key}}
                                </mat-checkbox>
                            </div>
                        </div>
                    </div>
                </form>
            </div> -->
            <div *ngIf="dropdownList" style="padding-top: 10px">
                <form [formGroup]="dropdownList">
                    <mat-form-field [style.width]="is_full ? '350px' : '100%'">
                        <mat-label>Select a Public Health Unit</mat-label>
                        <mat-select formControlName="phu" disableOptionCentering
                            (selectionChange)="routeonSelection(dropdownList.controls.phu.value)">
                            <ngx-mat-select-search formControlName="searchCtrl" [placeholderLabel]="'Search...'"
                                [noEntriesFoundLabel]="'Not found'" name="search"></ngx-mat-select-search>
                            <mat-option
                                *ngFor="let phu of phuArray |stringFilterBy:dropdownList.controls.searchCtrl.value:'phu'"
                                [value]="phu.value">
                                {{phu.phu}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </form>

                <!-- <mat-label><a target="_blank" href="https://www.phdapps.health.gov.on.ca/PHULocator/">Find a Public Health Unit</a> </mat-label> -->
            </div>
            <div *ngIf="dropdownList && is_full"
                style="padding-top: 30px; font-size: 24px; padding-bottom: 30px; text-align: center">
                {{headerLabel}}<br><span style="font-size:0.5em">In Beta. Please forward feedback to
                    info@howsmyflattening.ca</span>
            </div>
            <!-- <div *ngIf="filteringCheckboxes && dropdownList"> -->
            <div *ngIf="averageForm">
                <form [formGroup]="averageForm">
                    <div *ngIf="dropdownList">
                        <div *ngFor="let category of gridList">
                            <div *ngFor="let item of category | keyvalue">
                                <div *ngIf="category !== 'home' && category !== 'kpi-dash'">
                                    <!-- <div *ngIf="filteringCheckboxes.controls[item.key].value"> -->
                                    <div *ngFor="let phu of item.value | keyvalue">
                                        <div *ngIf="phu.key === dropdownList.controls.phu.value">
                                            <div [ngClass]="{'mobile-grid-row' : (!is_full && phu.key !== 'ontario'), 'mobile-grid-row-ontario': (!is_full && phu.key === 'ontario'), 'desktop-grid-row': is_full && phu.key !== 'ontario', 'desktop-grid-row-ontario': is_full && phu.key === 'ontario'}"
                                                style="display: grid; grid-template-columns: repeat(12, 1fr); row-gap: 24px; column-gap: 8px;"
                                                [style.height]="is_full ? (phu.key === 'ontario'? '100vh': '110vh') : (phu.key === 'ontario'? '750vh': '450vh')"
                                                [style.margin-left]="is_full ? '10px' : '0'"
                                                [style.min-height]="(is_full && phu.key === 'ontario') ? '1500px': '800px'">
                                                <div *ngFor="let phuGroup of phu.value | keyvalue"
                                                    style="height: 100%; background-color: #343332"
                                                    [style.grid-column]="is_full ? 'span 3' : 'span 12'"
                                                    [style.grid-row]="is_full ? 'span 3' : 'span 1'"
                                                    [style.padding]="is_full ? '10px' : 'initial'">
                                                    <div *ngFor="let phuPlot of phuGroup.value; index as index"
                                                        [style.height]="averageForm.controls[phuPlot.phu + '' + phuPlot.group + '' + phuPlot.header].value ? '100%' : '0'">
                                                        <div *ngIf="averageForm.controls[phuPlot.phu + '' + phuPlot.group + '' + phuPlot.header].value"
                                                            style="height: 100%">
                                                            <div style="height: 100%">
                                                                <div style="height: 25px">
                                                                    <div
                                                                        *ngIf="averageForm.controls[phuPlot.phu + '' +phuPlot.header + 'view'].value !== 'none'">
                                                                        <div
                                                                            style="display: flex; justify-content: space-between; border-bottom: 1px solid #666666">
                                                                            <div class="tab-styling"
                                                                                [ngClass]="{'tab-selected': averageForm.controls[phuPlot.phu + '' + phuPlot.header + 'view'].value === 'allTime'}"
                                                                                (click)="averageForm.controls[phuPlot.phu + '' + phuPlot.header + 'view'].setValue('allTime')">
                                                                                All Time</div>
                                                                            <div class="tab-styling"
                                                                                [ngClass]="{'tab-selected': averageForm.controls[phuPlot.phu + '' + phuPlot.header + 'view'].value === 'week'}"
                                                                                (click)="averageForm.controls[phuPlot.phu + '' + phuPlot.header + 'view'].setValue('week')">
                                                                                Prior Week</div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div style="display: flex; height: 40px">
                                                                    <div class="plot-check"
                                                                        *ngIf="averageForm.controls[phuPlot.phu + '' +phuPlot.header + 'average'].value !== 'none'">
                                                                        <div
                                                                            style="height: 20px; margin-right: 25px; border-radius: 6px; background-color: #245D70; color: #ffffff; padding: 6px 12px">
                                                                            <mat-checkbox
                                                                                [formControlName]="phuPlot.phu + '' +phuPlot.header + 'average'">
                                                                                7 Day Avg.
                                                                            </mat-checkbox>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <app-plot
                                                                    style="display: inline-block; width: 100%; height: calc(100% - 105px);"
                                                                    [graph_data]="phuPlot.html" [mobile_size]="!is_full"
                                                                    [display_average]="averageForm.controls[phuPlot.phu + '' +phuPlot.header + 'average'].value"
                                                                    [font_size_category]="plot_window"
                                                                    [cat]="phuPlot.phu+ '' +phuPlot.header"
                                                                    [view]="averageForm.controls[phuPlot.phu + '' +phuPlot.header + 'view'].value">
                                                                </app-plot>
                                                                <div *ngFor="let phuTab of tab_obj | keyvalue">
                                                                    <div *ngIf="phuTab.key === phuPlot.phu">
                                                                        <div
                                                                            *ngFor="let phuTabGroup of phuTab.value | keyvalue">
                                                                            <!-- <div *ngIf="phuTabGroup.key === phuPlot.group"
                                                                                style="height: 80px; border-top: 1px solid #666666; overflow-x: auto; white-space: nowrap;"
                                                                                [style.display]="phuTabGroup.value.length === 1 ? 'none': 'flex'">
                                                                                <div *ngFor="let phuTabHeader of phuTabGroup.value; index as index"
                                                                                    style="padding-right: 20px;"
                                                                                    [style.width]="index > 1 ? '1px' : '1px'"
                                                                                    [style.flex]="index > 1 ? '0 0' : '1 1 50%'">
                                                                                    <div style="color: #ffffff"
                                                                                        (click)="changeTabs(phuPlot.phu + '' + phuPlot.group, phuTabGroup.value, phuTabHeader.header)">
                                                                                        {{phuTabHeader.tab}}</div>
                                                                                </div>
                                                                            </div> -->
                                                                            <div *ngIf="phuTabGroup.key === phuPlot.group"
                                                                                class="plot-tab-group"
                                                                                [style.display]="phuTabGroup.value.length === 1 ? 'none': 'flex'">
                                                                                <div *ngFor="let phuTabHeader of phuTabGroup.value; index as index">
                                                                                    <div class="bottom-tab-styling"
                                                                                    [ngClass]="{'bottom-tab-selected': averageForm.controls[phuPlot.phu + '' + phuPlot.group + '' +phuTabHeader.header].value}"
                                                                                        (click)="changeTabs(phuPlot.phu + '' + phuPlot.group, phuTabGroup.value, phuTabHeader.header)">
                                                                                        {{phuTabHeader.tab}}</div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <!-- <mat-tab-group style="height: 100%">
                                                        <mat-tab label="First">
                                                            <div class="plot-container" style="height: 15%">
                                                                <form *ngIf="filteringCheckboxes"
                                                                    [formGroup]="filteringCheckboxes"
                                                                    class="plot-check">
                                                                    <div style="display: flex;">
                                                                        <div *ngFor="let category of gridList">
                                                                            <div *ngFor="let item of category | keyvalue"
                                                                                style="height: 20px; margin-right: 25px; border-radius: 6px; background-color: #245D70; color: #ffffff; padding: 6px 12px">
                                                                                <mat-checkbox
                                                                                    formControlName="{{item.key}}">
                                                                                    7 Day Avg.
                                                                                </mat-checkbox>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                            <app-plot
                                                                style="height: 85%; display: inline-block; width: 100%"
                                                                *ngIf="this.phuPlot" [graph_data]="phuPlot.html"
                                                                [mobile_size]="!is_full">
                                                            </app-plot>
                                                        </mat-tab>
                                                        <mat-tab style="height: 100%" label="Second">
                                                            <div class="plot-container" style="height: 15%">
                                                                <form *ngIf="filteringCheckboxes"
                                                                    [formGroup]="filteringCheckboxes"
                                                                    class="plot-check">
                                                                    <div style="display: flex;">
                                                                        <div *ngFor="let category of gridList">
                                                                            <div *ngFor="let item of category | keyvalue"
                                                                                style="height: 20px; margin-right: 25px; border-radius: 6px; background-color: #245D70; color: #ffffff; padding: 6px 12px">
                                                                                <mat-checkbox
                                                                                    formControlName="{{item.key}}">
                                                                                    7 Day Avg.
                                                                                </mat-checkbox>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                            <app-plot
                                                                style="height: 85%; display: inline-block; width: 100%"
                                                                *ngIf="this.phuPlot" [graph_data]="phuPlot.html"
                                                                [mobile_size]="!is_full">
                                                            </app-plot>
                                                        </mat-tab>
                                                    </mat-tab-group> -->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- </div> -->
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<hr>